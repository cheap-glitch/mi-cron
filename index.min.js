/*!
 * mi-cron
 *
 * A microscopic parser for standard cron expressions.
 *
 * Copyright (c) 2020-present, cheap glitch
 * This software is distributed under the ISC license
 */
Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseCron=void 0;const t={"@hourly":"0 * * * *","@daily":"0 0 * * *","@weekly":"0 0 * * 0","@monthly":"0 0 1 * *","@yearly":"0 0 1 1 *","@annually":"0 0 1 1 *"};function e(r){const n=r.trim().split(/\s+/);if(1==n.length)return n[0]in t?e(t[n[0]]):void 0;if(5==n.length){let t=void 0;try{t={minutes:o(n[0],0,59),hours:o(n[1],0,23),days:o(n[2],1,31),months:o(n[3],1,12,["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"]),weekDays:o(n[4],0,6,["sun","mon","tue","wed","thu","fri","sat"])}}catch(t){return}return t}}exports.parseCron=e;const r="(\\d{1,2}|[a-z]{3})",n=new RegExp(`^${r}(?:-${r})?$`,"i");function o(t,e,r,o=[]){const s=Array.from(new Set(t.split(",").flatMap(t=>{const[s,u="1"]=t.split("/",2),a=parseInt(u,10);if(Number.isNaN(a))throw Error();if("*"==s)return i(e,r,a);const l=s.match(n);if(!l)throw Error();const[c,d=(t.includes("/")?r:void 0)]=l.slice(1).map(t=>{if(o.includes(t))return o.indexOf(t);const n=parseInt(t,10);return!Number.isNaN(n)&&e<=n&&n<=r?n:void 0});if(void 0===c||void 0!==d&&d<c)throw Error();return null==d?[c]:i(c,d,a)})));return s.sort((t,e)=>t-e),s}function s(t){return new Date(Date.UTC(t.years,t.months-1,t.days,t.hours,t.minutes))}function i(t,e,r){return Array.from({length:Math.floor((e-t)/r)+1}).map((e,n)=>t+n*r)}e.nextDate=function(t,r=new Date){const n="string"==typeof t?e(t):t;if(void 0===n)return;const o={years:r.getUTCFullYear(),months:r.getUTCMonth()+1,days:r.getUTCDate(),hours:r.getUTCHours(),minutes:r.getUTCMinutes()+1},i=Object.keys(o);for(let t=1;t<i.length;t++){const e=i[t];n[e].includes(o[e])||(i.filter((e,r)=>r>t).forEach(t=>o[t]=n[t][0]),o[e]=n[e].find(t=>t>=o[e]),void 0===o[e]&&(o[e]=n[e][0],o[i[t-1]]++,t="months"!=e?t-2:t)),"days"!=e||n.weekDays.includes(s(o).getUTCDay())||(o.days++,o.hours=n.hours[0],o.minutes=n.minutes[0],t=1)}return s(o)};